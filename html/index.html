<!--
  index.html
  GJ_StampTour

  Created by Js Na on 2023/09/13.
  Copyright © 2023 Js Na, All rights reserved.
-->
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스탬프투어</title>
    <style>
        @import url('/css/font.css');
        @import url('/css/root.css');
        @import url('/css/StampListView.css');
        @import url('/css/MapView.css');

        body {
            width: 100%;
            height: 100%;
            touch-action: none;
            -webkit-touch-callout: none;
        }
        #GuideModalContainer {
            z-index: 56789;
        }

        .bi-x {
            width: 75%;
            height: 75%;
            position: absolute;
        }

        /* 가이드 */
        /*
        쓸 일은 없겠다만 iOS 6 느낌
        element.style {
            background: linear-gradient(#b4bfce 0%, #4e6484 100%);
            outline: 2px solid #445673;
        }
        body {
        background: #d2d4dd;
            background-image: linear-gradient(90deg, transparent 30%, rgba(0, 0, 0, 0.02) 45%, rgba(0, 0, 0, 0.02) 55%, transparent 70%);
            background-size: 8px 8px;
        }
        
        */
        .GuideContainer {
            padding: 1em;
            box-sizing: border-box;
        }

        .FooterContainer {
            display: flex;
            width: 100%;
            left: 0;
            bottom: 0;
        }

        #GuideHint {
            margin: 0;
            word-break: keep-all;
        }

        .GuideVideo {
            width: 100%;
            max-height: 45vh;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .LinkButton {
            margin: 0;
            padding: 0;
            font-size: 1em;
            background: none;
            border: none;
            color: #007aff;
        }

        .LongButton {
            background-color: #4E7CF1;
            color: #FFFFFF;
            font-size: 1.5em;
            font-weight: 800;
            width: 100%;
            height: 2em;
            border: none;
            border-radius: 10px;
            margin: 0 1em 1em;
            transition: background-color 0.2s ease-in-out;
        }

        .LongButton:disabled {
            background-color: #A0A0A0;
        }

        .GuideText {
            margin: 0.3em;
            text-align: center;
            word-break: keep-all;
        }

        #PrivacyPolicyCheckboxContainer {
            display: none;
            flex-direction: row;
            align-items: center;
            justify-content: center;
        }

        #GuideText {
            font-weight: 600;
        }

        #UserRegisterContainer {
            margin: 5em 0;
        }

        .UserRegisterInput {
            display: none;
            opacity: 0;
            width: 100%;
            border: 1px solid #AFAFAF;
            border-radius: 25px;
            font-size: 1.3em;
            margin: 0.5em 0;
            padding: 0.2em;
            box-sizing: border-box;
            text-align: center;
            transition: all 0.5s ease-in-out;
        }

        .UserRegisterInput.show {
            opacity: 1;
        }

        .UserRegisterInput:focus {
            border: 1px solid #4E7CF1;
            outline: 1px solid #4E7CF1;
        }

        #ReplayButtonContainer {
            visibility: hidden;
            text-align: center;
        }

        .BottomContainer {
            position: absolute;
            display: flex;
            flex-direction: row;
            align-items: flex-end;
            justify-content: space-between;
            bottom: 0;
            padding: 5em 1em;
            box-sizing: border-box;
        }
        .BottomContainer.right {
            right: 0;
        }
        .BottomContainer.left {
            left: 0;
        }
        .BottomContainer a {
            width: 5em;
            background-color: #4E7CF1;
            border: 2px solid #ffffff;
            text-align: center;
            padding: 0.5em;
            margin-bottom: 1em;
            border-radius: 100px;
            color: #ffffff;
            font-weight: 700;
            transition: all 0.2s ease-in-out;
        }
        .BottomContainer a:focus {
            outline: none;
        }

        #FloorSelect {
            display: flex;
            flex-direction: column;
            margin-bottom: 0.8em;
        }

        #FloorSelect a {
            background-color: #ffffff;
            color: #4E7CF1;
            margin-bottom: 0.2em;
            border: 2px solid #4E7CF1;
        }

        #FloorSelect a.selected {
            background-color: #4E7CF1;
            border: 2px solid #ffffff;
            color: #ffffff;
            margin-bottom: 0.2em;
        }

    </style>
</head>

<body style="overflow: hidden">
    <div id="titleBar" class="titleBar">
        <img class="titleLogo" src="/images/StampTourLogo.png" alt="스탬프투어">
        <h2>축제 부스 지도</h2>
    </div>
    <div id="MapContainer" class="MainContainer MapContainer" style="width: 100%; height: inherit; overflow: hidden; cursor: default;">
        <!--<div id="MainMapView">-->
       <!--<svg id="AlwaysVisibleMap" class="active">
            <polygon class="hallway" points="90,360 130,400 150,400 150,500 130,500 90,540 0,450" />
            <rect class="hallway" x="150" y="100" width="50" height="300" />
            <rect class="hallway" x="150" y="400" width="1100" height="50" />
            <rect class="hallway" x="150" y="450" width="150" height="100" />
            <rect class="hallway" x="800" y="0" width="50" height="100" />
            <rect class="hallway" x="850" y="0" width="50" height="400" />
            <rect class="hallway" x="1100" y="450" width="50" height="100" />
            <rect class="hallway" x="1200" y="450" width="50" height="550" />
        </svg>-->
        <svg id="Floor1MapView" class="active">
            <g id="Floor1Map">
                <polygon class="hallway" points="90,360 130,400 150,400 150,500 130,500 90,540 0,450" />
                <rect class="hallway" x="150" y="100" width="50" height="300" />
                <rect class="hallway" x="150" y="400" width="1100" height="50" />
                <rect class="hallway" x="150" y="450" width="150" height="100" />
                <rect class="hallway" x="800" y="0" width="50" height="100" />
                <rect class="hallway" x="850" y="0" width="50" height="400" />
                <rect class="hallway" x="1100" y="450" width="50" height="100" />
                <rect class="hallway" x="1200" y="450" width="50" height="400" />
                <g id="이동수업실1" class="classroom">
                    <rect x="100" y="0" width="200" height="100" />
                    <text x="200" y="50" dy="-0.3em">이동수업실1</text>
                    <text x="200" y="50" dy="0.8em" style="font-size: 1em;">(축제예비공간)</text>
                </g>
                <rect class="notClassroom" x="100" y="100" width="50" height="100" />
                <rect class="notClassroom" x="200" y="100" width="100" height="50" />
                <g id="컴퓨터실" class="classroom">
                    <rect x="200" y="150" width="100" height="150" />
                    <text x="250" y="225">컴퓨터실</text>
                </g>
                <g id="행정실" class="notClassroom">
                    <rect x="300" y="450" width="150" height="100" />
                    <text x="375" y="500">행정실</text>
                </g>
                <g id="교장실" class="notClassroom">
                    <rect x="450" y="450" width="150" height="100" />
                    <text x="525" y="500">교장실</text>
                </g>
                <rect class="notClassroom" x="600" y="450" width="150" height="100" />
                <g id="보건실" class="notClassroom">
                    <rect x="750" y="450" width="150" height="100" />
                    <text x="825" y="500">보건실</text>
                </g>
                <rect class="notClassroom" x="900" y="450" width="150" height="100" />
                <g id="밴드실" class="notClassroom">
                    <rect x="1250" y="400" width="100" height="150" />
                    <text x="1300" y="475">밴드실</text>
                </g>
                <rect class="notClassroom" x="1250" y="550" width="100" height="150" />
                <g id="시청각실" class="notClassroom">
                    <rect x="1250" y="700" width="100" height="150" />
                    <text x="1300" y="775">시청각실</text>
                </g>
                <g id="화장실1" class="notClassroom">
                    <rect x="200" y="300" width="100" height="100" />
                    <text x="250" y="350">화장실</text>
                </g>
                <g id="화장실2" class="notClassroom">
                    <rect x="750" y="300" width="100" height="100" />
                    <text x="800" y="350">화장실</text>
                </g>
                <rect class="notClassroom" x="1050" y="450" width="50" height="100" />
                <g id="세담터도서관" class="notClassroom">
                    <rect x="900" y="0" width="100" height="400" />
                    <text x="950" y="200" dy="-0.3em">세담터</text>
                    <text x="950" y="200" dy="0.8em" style="font-size: 1em;">(도서관)</text>
                </g>
                <g id="운동장" class="classroom">
                    <rect x="450" y="650" width="650" height="150" />
                    <text x="775" y="725">운동장</text>
                </g>
                <g id="농구장" class="classroom">
                    <rect x="800" y="800" width="300" height="50" />
                    <text x="950" y="825">농구장</text>
                </g>
            </g>
        </svg>
        <svg id="Floor2MapView">
            <g id="Floor2Map">
                <polygon class="hallway" points="90,360 130,400 150,400 150,500 130,500 90,540 0,450" />
                <rect class="hallway" x="150" y="100" width="50" height="300" />
                <rect class="hallway" x="150" y="400" width="1100" height="50" />
                <rect class="hallway" x="150" y="450" width="150" height="100" />
                <rect class="hallway" x="800" y="0" width="50" height="100" />
                <rect class="hallway" x="850" y="0" width="50" height="400" />
                <rect class="hallway" x="1100" y="450" width="50" height="100" />
                <rect class="hallway" x="1200" y="450" width="50" height="550" />
                <!--차오름관연결통로-->
                <rect class="hallway" x="200" y="550" width="100" height="150" />
                <g id="화학실" class="classroom">
                    <rect x="100" y="0" width="150" height="100" />
                    <text x="175" y="50">화학실</text>
                </g>
                <rect class="notClassroom" x="250" y="0" width="50" height="100" />
                <g id="생명과학실" class="classroom">
                    <rect x="200" y="100" width="100" height="150" />
                    <text x="250" y="175" style="font-size: 1em;">생명과학실</text>
                </g>
                <g id="학생회실" class="notClassroom">
                    <rect x="100" y="100" width="50" height="100" />
                    <text x="123" y="150" style="font-size: 1em; writing-mode: vertical-rl;">학생회실</text>
                </g>
                <g id="진로상담부" class="notClassroom">
                    <rect x="200" y="250" width="100" height="50" />
                    <text x="250" y="275" style="font-size: 1em;">진로상담부</text>
                </g>
                <g id="교실106" class="classroom">
                    <rect x="300" y="450" width="150" height="100" />
                    <text x="375" y="500">교실 1-6</text>
                </g>
                <g id="교실107" class="classroom">
                    <rect x="450" y="450" width="150" height="100" />
                    <text x="525" y="500">교실 1-7</text>
                </g>
                <g id="방송실" class="notClassroom">
                    <rect x="600" y="450" width="150" height="100" />
                    <text x="675" y="500">방송실</text>
                </g>
                <g id="교무실1" class="notClassroom">
                    <rect x="750" y="450" width="150" height="100" />
                    <text x="825" y="500">교무실</text>
                </g>
                <rect class="notClassroom" x="900" y="450" width="150" height="100" />
    
                <g id="교실108" class="classroom">
                    <rect x="1250" y="400" width="100" height="150" />
                    <text x="1300" y="475">교실 1-8</text>
                </g>
                <g id="교실109" class="classroom">
                    <rect x="1250" y="550" width="100" height="150" />
                    <text x="1300" y="625">교실 1-9</text>
                </g>
                <g id="교실110" class="classroom">
                    <rect x="1250" y="700" width="100" height="150" />
                    <text x="1300" y="775">교실 1-10</text>
                </g>
                <g id="교실111" class="classroom">
                    <rect x="1250" y="850" width="100" height="150" />
                    <text x="1300" y="925">교실 1-11</text>
                </g>
                <g id="화장실1" class="notClassroom">
                    <rect x="200" y="300" width="100" height="100" />
                    <text x="250" y="350">화장실</text>
                </g>
                <g id="화장실2" class="notClassroom">
                    <rect x="750" y="300" width="100" height="100" />
                    <text x="800" y="350">화장실</text>
                </g>
    
                <g id="교무실2" class="notClassroom">
                    <rect x="900" y="300" width="100" height="100" />
                    <text x="950" y="350">교무실</text>
                </g>
                <rect class="notClassroom" x="1050" y="450" width="50" height="100" />
                <rect class="notClassroom" x="900" y="0" width="100" height="200" />
                <g id="공용교실" class="classroom">
                    <rect x="900" y="200" width="100" height="100" />
                    <text x="950" y="250">공용교실</text>
                </g>
                <g id="차오름관" class="classroom">
                    <rect x="150" y="700" width="200" height="300" />
                    <text x="250" y="850">차오름관</text>
                </g>
            </g>
        </svg>
        <svg id="Floor3MapView">
            <g id="Floor3Map">
                <polygon class="hallway" points="90,360 130,400 150,400 150,500 130,500 90,540 0,450" />
                <rect class="hallway" x="150" y="100" width="50" height="300" />
                <rect class="hallway" x="150" y="400" width="1100" height="50" />
                <rect class="hallway" x="150" y="450" width="150" height="100" />
                <rect class="hallway" x="800" y="0" width="50" height="100" />
                <rect class="hallway" x="850" y="0" width="50" height="400" />
                <rect class="hallway" x="1100" y="450" width="50" height="100" />
                <rect class="hallway" x="1200" y="450" width="50" height="550" />
                <g id="물리지학실" class="classroom">
                    <rect x="100" y="0" width="150" height="100" />
                    <text x="175" y="50">물리·지학실</text>
                </g>
                <rect class="notClassroom" x="250" y="0" width="50" height="100" />
                <g id="다원반" class="notClassroom">
                    <rect x="200" y="100" width="100" height="150" />
                    <text x="250" y="175">다원반</text>
                </g>
                <g id="진로활동실" class="classroom">
                    <rect x="100" y="100" width="50" height="100" />
                    <text x="123" y="150" style="font-size: 1em; writing-mode: vertical-rl;">진로활동실</text>
                </g>
                <g id="파스칼실(수)" class="notClassroom">
                    <rect x="200" y="250" width="100" height="50" />
                    <text x="250" y="275" dy="-0.3em" style="font-size: 1em;">파스칼실</text>
                    <text x="250" y="275" dy="0.8em" style="font-size: 0.8em; font-weight: normal;">(수)</text>
                </g>
                <g id="이동수업실2" class="classroom">
                    <rect x="300" y="450" width="150" height="100" />
                    <text x="375" y="500">이동수업실2</text>
                </g>
                <g id="이동수업실3" class="classroom">
                    <rect x="450" y="450" width="150" height="100" />
                    <text x="525" y="500">이동수업실3</text>
                </g>
                <g id="교실201" class="classroom">
                    <rect x="600" y="450" width="150" height="100" />
                    <text x="675" y="500">교실 2-1</text>
                </g>
                <g id="교실202" class="classroom">
                    <rect x="750" y="450" width="150" height="100" />
                    <text x="825" y="500">교실 2-2</text>
                </g>
                <g id="교실101" class="classroom">
                    <rect x="900" y="450" width="150" height="100" />
                    <text x="975" y="500">교실 1-1</text>
                </g>
                <g id="교실102" class="classroom">
                    <rect x="1250" y="400" width="100" height="150" />
                    <text x="1300" y="475">교실 1-2</text>
                </g>
                <g id="교실103" class="classroom">
                    <rect x="1250" y="550" width="100" height="150" />
                    <text x="1300" y="625">교실 1-3</text>
                </g>
                <g id="교실104" class="classroom">
                    <rect x="1250" y="700" width="100" height="150" />
                    <text x="1300" y="775">교실 1-4</text>
                </g>
                <g id="교실105" class="classroom">
                    <rect x="1250" y="850" width="100" height="150" />
                    <text x="1300" y="925">교실 1-5</text>
                </g>
    
                <g id="화장실1" class="notClassroom">
                    <rect x="200" y="300" width="100" height="100" />
                    <text x="250" y="350">화장실</text>
                </g>
                <g id="화장실2" class="notClassroom">
                    <rect x="750" y="300" width="100" height="100" />
                    <text x="800" y="350">화장실</text>
                </g>
    
                <g id="교무실3" class="notClassroom">
                    <rect x="900" y="300" width="100" height="100" />
                    <text x="950" y="350">교무실</text>
                </g>
                <rect class="notClassroom" x="1050" y="450" width="50" height="100" />
                <rect class="notClassroom" x="900" y="0" width="100" height="200" />
                <g id="1학년학습실" class="notClassroom">
                    <rect x="900" y="200" width="100" height="100" />
                    <text x="950" y="250" style="font-size: 1em;">1학년 학습실</text>
                </g>
            </g>
        </svg>
        <svg id="Floor4MapView">
            <g id="Floor4Map">
                <polygon class="hallway" points="90,360 130,400 150,400 150,500 130,500 90,540 0,450" />
                <rect class="hallway" x="150" y="100" width="50" height="300" />
                <rect class="hallway" x="150" y="400" width="1100" height="50" />
                <rect class="hallway" x="150" y="450" width="150" height="100" />
                <rect class="hallway" x="800" y="0" width="50" height="100" />
                <rect class="hallway" x="850" y="0" width="50" height="400" />
                <rect class="hallway" x="1100" y="450" width="50" height="100" />
                <rect class="hallway" x="1200" y="450" width="50" height="550" />
                <g id="기술실" class="notClassroom">
                    <rect x="100" y="0" width="150" height="100" />
                    <text x="175" y="50">기술실</text>
                </g>
                <rect class="notClassroom" x="250" y="0" width="50" height="100" />
                <g id="가사실" class="notClassroom">
                    <rect x="200" y="100" width="100" height="150" />
                    <text x="250" y="175">가사실</text>
                </g>
                <g id="뉴턴실(수)" class="notClassroom">
                    <rect x="100" y="100" width="50" height="100" />
                    <text x="125" y="150" dy="-0.3em" style="font-size: 1em;">뉴턴실</text>
                    <text x="125" y="150" dy="0.8em" style="font-size: 0.8em; font-weight: normal;">(수)</text>
                </g>
                <g id="가우스실(수)" class="notClassroom">
                    <rect x="200" y="250" width="100" height="50" />
                    <text x="250" y="275" dy="-0.3em" style="font-size: 1em;">가우스실</text>
                    <text x="250" y="275" dy="0.8em" style="font-size: 0.8em; font-weight: normal;">(수)</text>
                </g>
                <g id="교실203" class="classroom">
                    <rect x="300" y="450" width="150" height="100" />
                    <text x="375" y="500">교실 2-3</text>
                </g>
                <g id="교실204" class="classroom">
                    <rect x="450" y="450" width="150" height="100" />
                    <text x="525" y="500">교실 2-4</text>
                </g>
                <g id="교실205" class="classroom">
                    <rect x="600" y="450" width="150" height="100" />
                    <text x="675" y="500">교실 2-5</text>
                </g>
                <g id="교실206" class="classroom">
                    <rect x="750" y="450" width="150" height="100" />
                    <text x="825" y="500">교실 2-6</text>
                </g>
                <g id="교실207" class="classroom">
                    <rect x="900" y="450" width="150" height="100" />
                    <text x="975" y="500">교실 2-7</text>
                </g>
                <g id="교실208" class="classroom">
                    <rect x="1250" y="400" width="100" height="150" />
                    <text x="1300" y="475">교실 2-8</text>
                </g>
                <g id="교실209" class="classroom">
                    <rect x="1250" y="550" width="100" height="150" />
                    <text x="1300" y="625">교실 2-9</text>
                </g>
                <g id="교실210" class="classroom">
                    <rect x="1250" y="700" width="100" height="150" />
                    <text x="1300" y="775">교실 2-10</text>
                </g>
                <g id="교실211" class="classroom">
                    <rect x="1250" y="850" width="100" height="150" />
                    <text x="1300" y="925">교실 2-11</text>
                </g>
    
                <g id="화장실1" class="notClassroom">
                    <rect x="200" y="300" width="100" height="100" />
                    <text x="250" y="350">화장실</text>
                </g>
                <g id="화장실2" class="notClassroom">
                    <rect x="750" y="300" width="100" height="100" />
                    <text x="800" y="350">화장실</text>
                </g>
    
                <g id="교무실" class="notClassroom">
                    <rect x="900" y="300" width="100" height="100" />
                    <text x="950" y="350">교무실</text>
                </g>
                <rect class="notClassroom" x="1050" y="450" width="50" height="100" />
                <rect class="notClassroom" x="900" y="0" width="100" height="200" />
                <g id="2학년학습실이동수업실4" class="classroom">
                    <rect x="900" y="200" width="100" height="100" />
                    <text x="950" y="250" dy="-0.5em" style="font-size: 1em;">2학년 학습실</text>
                    <text x="950" y="250" dy="0.8em" style="font-size: 1em;">이동수업실4</text>
                </g>
            </g>
        </svg>
    <!--</div>-->
    </div>
    <div id="ClassInfoModalContainer" class="ModalContainer">
        <div id="ClassInfoModal" class="Modal">
            <div class="ModalTitleContainer">
                <h2 id="ModalTitle">교실2-8</h2>
            </div>
            <div class="ModalContent">
                <p>TODO: 동아리 목록 표시</p>
                <!--<p>동아리 정보가 없습니다.</p>-->
                <!--<span style="display: flex;"><h3>(체크)</h3>&nbsp;&nbsp;<h3>동아리 이름</h3>&nbsp;&nbsp;<h3><a>기록 보기</a></h3></span>-->
            </div>
        </div>
        <button id="ClassInfoModalCloseButton" class="ModalCloseButton">
            <svg xmlns="http://www.w3.org/2000/svg" class="bi bi-x" viewBox="0 0 16 16">
                <path
                    d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
            </svg>
        </button>
    </div>
    <div id="GuideModalContainer" class="ModalContainer">
        <div id="GuideModal" class="Modal">
            <div class="GuideContainer">
                <span id="GuideTitleContainer">
                    <h1 id="GuideTitle">스탬프투어 참여 방법</h1>
                    <p id="GuideHint">참여 방법을 알려 드릴게요.</p>
                </span>
                <hr>
                <video id="GuideVideo" class="GuideVideo" playsinline muted>
                </video>
                <div id="UserRegisterContainer">
                    <input id="StudentIdInput" class="UserRegisterInput" type="text" inputmode="numeric" pattern="\d*"
                        placeholder="학번">
                    <input id="StudentNameInput" class="UserRegisterInput" type="text" placeholder="이름">
                </div>
                <div id="PrivacyPolicyCheckboxContainer">
                    <input type="checkbox" id="PrivacyPolicyCheckbox">
                    <label for="PrivacyPolicyCheckbox"><a href="/privacypolicy">개인정보처리방침에</a> 동의합니다.</label>
                </div>
                <h3 id="GuideText" class="GuideText"></h3>
                <div id="ReplayButtonContainer">
                    <button id="ReplayGuideButton" class="LinkButton">다시 보기 &gt;</a>
                </div>
            </div>
            <div class="FooterContainer">
                <button id="NextGuideButton" class="LongButton">다 음</button>
            </div>
        </div>
    </div>
    <div class="BottomContainer left">
        <div id="FloorSelect">
            <a id="Floor4" href="#Floor4">4층</a>
            <a id="Floor3" href="#Floor3">3층</a>
            <a id="Floor2" href="#Floor2">2층</a>
            <a id="Floor1" class="selected" href="#Floor1">1층</a>
        </div>
    </div> 

    <div class="BottomContainer right">
        <a id="TagScanButton" href="/scanner" target="_blank">태그 스캔</a>
    </div>
    <div id="StampView" class="StampView"></div>

</body>
<script src="/scripts/root.js"></script>
<script src="/scripts/index.js"></script>
<script src="/scripts/JsAPI.js"></script>
<script src="https://unpkg.com/panzoom@9.4.3/dist/panzoom.min.js"></script>
<script>
    function enableMapZoom(mapElement) {
    if ('ontouchstart' in window || navigator.msMaxTouchPoints) {
        zoom = panzoom(mapElement, {
            bounds: true,
                    boundsPadding: 0,
                    maxZoom: 2,
                    minZoom: 0.3,
                    zoomDoubleClickSpeed: 1,
            onTouch: (e) => {
                const targetElem = e.target;
                console.log(targetElem.classList[0]);
                if ((targetElem.classList[0] != "hallway" && targetElem.classList[0] != "notClassroom")  && (targetElem.tagName === "g" || targetElem.tagName === "rect" || targetElem.tagName === "text")) {
                    return false;
                } else {
                    e.preventDefault();
                }
            }
        });
    } else {
        zoom = panzoom(mapElement, {
            bounds: true,
            boundsPadding: -0.5,
            maxZoom: 5,
            minZoom: 0.5,
            zoomDoubleClickSpeed: 1,
            contain: 'outside'
        });
    }
}

    let CurrentFloor = 1;
    //let AlwaysVisibleMapView = eById("AlwaysVisibleMap");
    let Floor1Button = eById("Floor1");
    let Floor2Button = eById("Floor2");
    let Floor3Button = eById("Floor3");
    let Floor4Button = eById("Floor4");
    //enableMapZoom(eById("MainMapView"))
    
    //enableMapZoom(AlwaysVisibleMapView);
    enableMapZoom(eById("Floor1MapView"));
    enableMapZoom(eById("Floor2MapView"));
    enableMapZoom(eById("Floor3MapView"));
    enableMapZoom(eById("Floor4MapView"));
    function animateFloorChange(f) {
        /*console.log(`CurrentFloor: ${CurrentFloor}, f: ${f}`);
        let CurrentFloorMap = eById(`Floor${CurrentFloor}MapView`);
        let NewFloorMap = eById(`Floor${f}MapView`);
        eById(`Floor${CurrentFloor}`).classList.remove("selected");
        eById(`Floor${f}`).classList.add("selected");
        if (CurrentFloor > f) {
            console.log("ZoomInAndFade");
            CurrentFloorMap.classList.add("ZoomInAndFadeOut");
            AlwaysVisibleMapView.classList.add("ZoomInAndFadeOut");
            setTimeout(() => {
                CurrentFloorMap.classList.remove("active");
                NewFloorMap.classList.add("active");
                CurrentFloorMap.classList.remove("ZoomInAndFadeOut");
                AlwaysVisibleMapView.classList.remove("ZoomInAndFadeOut");
                AlwaysVisibleMapView.classList.add("ZoomInAndFadeIn");
                NewFloorMap.classList.add("ZoomInAndFadeIn");
            }, 200);
            setTimeout(() => {
                AlwaysVisibleMapView.classList.remove("ZoomInAndFadeIn");
                NewFloorMap.classList.remove("ZoomInAndFadeIn");
            }, 500);
        } else if (CurrentFloor < f) {
            console.log("ZoomOutAndFade");
            CurrentFloorMap.classList.add("ZoomOutAndFadeOut");
            AlwaysVisibleMapView.classList.add("ZoomOutAndFadeOut");

            setTimeout(() => {
                CurrentFloorMap.classList.remove("active");
                NewFloorMap.classList.add("active");
                CurrentFloorMap.classList.remove("ZoomOutAndFadeOut");
                AlwaysVisibleMapView.classList.remove("ZoomOutAndFadeOut");
                AlwaysVisibleMapView.classList.add("ZoomOutAndFadeIn");
                NewFloorMap.classList.add("ZoomOutAndFadeIn");
            }, 200);
            setTimeout(() => {
                AlwaysVisibleMapView.classList.remove("ZoomOutAndFadeIn");
                NewFloorMap.classList.remove("ZoomOutAndFadeIn");
            }, 500);
        }*/
        let CurrentFloorMap = eById(`Floor${CurrentFloor}MapView`);
        let NewFloorMap = eById(`Floor${f}MapView`);
        eById(`Floor${CurrentFloor}`).classList.remove("selected");
        eById(`Floor${f}`).classList.add("selected");
        CurrentFloorMap.classList.remove("active");
        NewFloorMap.classList.add("active");
        CurrentFloor = f;
    }
    Floor1Button.addEventListener("click", () => {
        animateFloorChange(1);
    });
    Floor2Button.addEventListener("click", () => {
        animateFloorChange(2);
    });
    Floor3Button.addEventListener("click", () => {
        animateFloorChange(3);
    });
    Floor4Button.addEventListener("click", () => {
        animateFloorChange(4);
    });
    if (window.location.hash.startsWith("#Floor")) {
        animateFloorChange(window.location.hash.replace("#Floor", ""));
    }
    // MapContainer get child element that has class "classroom"
    let classroomList = document.getElementsByClassName("classroom");
    console.log(classroomList);
    for (let i = 0; i < classroomList.length; i++) {
        classroomList[i].addEventListener("click", () => {
            console.log(classroomList[i].id);
            eById("ClassInfoModalContainer").style.display = "flex";
            eById("ModalTitle").innerText = classroomList[i].id;
        });
    }
    let notClassroomList = document.getElementsByClassName("notClassroom");
    for (let i = 0; i < notClassroomList.length; i++) {
        notClassroomList[i].addEventListener("click", () => {
            alert(`${notClassroomList[i].id}의 부스 정보가 없습니다.`);
        });
    }
    let StampView = eById("StampView");
    let GuideModalContainer = eById("GuideModalContainer");

    window.onload = function () {
        init();
        getClassroomList();
        if (getCookie("ShowGuide") == null) {
            //window.location.href = "/guide";
            GuideModalContainer.style.display = "flex";
            showNextGuide();
        }
        /*eById("TagScanButton").addEventListener("click", () => {
            window.location.href = "/scanner";
        });*/
    }
    let touchstartY = 0;
    let touchendY = 0;

    function checkDirection() {
        if (touchendY < touchstartY) {
            if (!StampView.classList.contains("open")) {
                StampView.classList.toggle("open");
            }
        } else if (touchendY > touchstartY) {
            if (StampView.classList.contains("open")) {
                StampView.classList.toggle("open");
            }
        }
    };

    StampView.addEventListener('touchstart', e => {
        let stampListView = eById("stampList");
        let targetTagName = e.target.tagName.toLowerCase();
        console.log(e.target);
        console.log(e.target.tagName.toLowerCase());
        console.log(stampListView.scrollTop);
        if (stampListView.scrollTop <= 0) {
            console.log("scroll top")
            touchstartY = e.changedTouches[0].screenY;
        } else if (e.target != stampListView && e.target.classList[0] != "stamp" && targetTagName != "img" && targetTagName != "h3") {
            touchstartY = e.changedTouches[0].screenY;
        } else {
            touchstartY = 0;
        }
    });

    StampView.addEventListener('touchend', e => {
        let stampListView = eById("stampList");
        let targetTagName = e.target.tagName.toLowerCase();
        if (stampListView.scrollTop <= 0) {
            touchendY = e.changedTouches[0].screenY;
            checkDirection();
        } else if (e.target != stampListView && e.target.classList[0] != "stamp" && targetTagName != "img" && targetTagName != "h3") {
            touchendY = e.changedTouches[0].screenY;
            checkDirection();
        }
    });
    eById("ClassInfoModalCloseButton").addEventListener("click", () => {
        eById("ClassInfoModalContainer").style.display = "none";
    });

    /* 가이드 */
    let VideoPlayer = eById("GuideVideo");
    let GuideText = eById("GuideText");
    let NextGuideButton = eById("NextGuideButton");
    NextGuideButton.addEventListener("click", showNextGuide);
    let guidePage = 0;
    VideoPlayer.pause();
    let StudentIdInput = eById("StudentIdInput");
    let StudentNameInput = eById("StudentNameInput");

    let userAgent = window.navigator.userAgent.toLowerCase();

    let displayDeviceType = "접속하신 기기";
    let displayNFCLocation = "후면 중앙";
    if (window.screen.width > 1024) {
        loadGuideVideo("NoNFC");
        displayDeviceType = "태블릿 또는 NFC 기능이 없는 휴대전화";
    } else if (userAgent.includes("iphone")) {
        displayDeviceType = "iPhone";
        displayNFCLocation = "상단";
        loadGuideVideo("iPhone");
        document.ondblclick = function(e) {
            e.preventDefault();
        }
    } else if (userAgent.includes("sm-f700") || userAgent.includes("sm-f711") || userAgent.includes("sm-f721") || userAgent.includes("sm-f731")) {
        displayDeviceType = "갤럭시 Z 플립";
        displayNFCLocation = "후면 하단";
        loadGuideVideo("Bottom");
    } else {
        loadGuideVideo("Center");
    }

    eById("GuideHint").innerText = `${displayDeviceType}에서의 참여 방법을 알려 드릴게요.`;
    eById("ReplayGuideButton").addEventListener("click", () => {
        guidePage = 0;
        showNextGuide();
    });
    var loginResponse;
    function showNextGuide() {
        console.log(guidePage);
        NextGuideButton.disabled = true;
        VideoPlayer.play();
        VideoPlayer.pause();
        VideoPlayer.style.opacity = 1;
        switch (guidePage) {
            case 0:
                VideoPlayer.currentTime = 0;
                if (window.screen.width > 1024) {
                    GuideText.innerText = `${displayDeviceType}에서는 "태그 스캔" 버튼을 눌러서 참여할 수 있어요.`;
                } else {
                    GuideText.innerText = `${displayDeviceType}의 NFC 인식 위치는 ${displayNFCLocation}이에요.`;
                }
                setTimeout(() => {
                    VideoPlayer.play();
                    setTimeout(() => {
                        VideoPlayer.pause();
                        NextGuideButton.disabled = false;
                    }, 840);
                    guidePage += 1;
                }, 500);
                break;
            case 1:
                VideoPlayer.play();
                if (window.screen.width > 1024) {
                    GuideText.innerText = `스탬프의 아이콘을 카메라로 스캔해 주세요.`;
                } else {
                    GuideText.innerText = `스탬프의 아이콘에 ${displayDeviceType}의 ${displayNFCLocation}을 대주세요.`;
                }
                setTimeout(() => {
                    VideoPlayer.pause();
                    NextGuideButton.disabled = false;
                    eById("ReplayButtonContainer").style.visibility = "visible";
                }, 4000);
                guidePage += 1;
                break;
            case 2:
                NextGuideButton.disabled = true;
                NextGuideButton.innerText = "시작하기";
                GuideText.style.display = "none";
                VideoPlayer.style.display = "none";
                eById("ReplayButtonContainer").style.display = "none";
                eById("PrivacyPolicyCheckboxContainer").style.display = "flex";

                eById("GuideTitle").innerText = "시작 전 본인의 정보를 알려주세요";
                eById("GuideHint").innerText = "타인의 정보를 도용할 경우 불이익이 있을 수 있습니다.";
                eById("GuideHint").style.color = "#FF0000";

                StudentIdInput.addEventListener("input", () => {
                    StudentIdInput.value = StudentIdInput.value.replace(/[^0-9]/g, '');
                    let l = StudentIdInput.value.length;
                    if (l >= 6) {
                        StudentIdInput.value = StudentIdInput.value.slice(0, 5);
                    } else if (l >= 5) {
                        StudentNameInput.focus();
                    }
                });
                StudentNameInput.addEventListener("input", () => {
                    let l = StudentNameInput.value.length;
                    if (l >= 2) {
                        NextGuideButton.disabled = false;
                    } else {
                        NextGuideButton.disabled = true;
                    }
                });
                StudentIdInput.style.display = "block";
                StudentNameInput.style.display = "block";
                setTimeout(() => {
                    StudentIdInput.classList.add("show");
                    StudentNameInput.classList.add("show");
                }, 100);

                guidePage += 1;
                break;
            case 3:
                var xhr = new XMLHttpRequest();
                xhr.open('POST', "/login", true);
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.responseType = 'json';
                xhr.onload = function() {
                    var status = xhr.status;
                    if (status === 200) {
                        console.log(xhr.response);
                        alert(`${xhr.response.user_name}(${xhr.response.user_id})님, 환영합니다.)`);
                        setCookie("userid", xhr.response.user_id, 7);
                        setCookie("username", StudentIdInput.value + StudentNameInput.value, 7);
                        setCookie("ShowGuide", "true", 1);
                        guidePage = 0;
                        GuideModalContainer.style.display = "none";
                    } else {
                        console.warn(xhr.response);
                        alert(`로그인에 실패했습니다. 다시 시도해 주세요.`);
                    }
                };
                xhr.send(`{ "user_name": "${StudentIdInput.value}${StudentNameInput.value}" }`); // 보낼 데이터 지정
             /*
                fetch("/login", {
                    method: "POST",
                    credentials: 'include',
                    body: JSON.stringify({
                        username: StudentIdInput.value + StudentNameInput.value,
                    }),
                    headers: {
                        "Content-type": "application/json; charset=UTF-8"
                    }
                })
                    .then((response) => {
                        loginResponse = response;
                        response.json();
                        alert(response);
                        console.log(response);
                    })
                    .then((json) => {
                        alert(json);
                        console.log(json);
                    });
                    */

                break;
            default:
                break;
        }
    }
    function loadGuideVideo(deviceType) {
        let source1 = document.createElement("source");
        source1.src = `/videos/Guide_NFC_${deviceType}.webm`;
        source1.type = "video/webm";
        let source2 = document.createElement("source");
        source2.src = `/videos/Guide_NFC_${deviceType}.mov`;
        source2.type = "video/mp4";
        VideoPlayer.appendChild(source1);
        VideoPlayer.appendChild(source2);
    }
</script>

</html>