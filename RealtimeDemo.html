<!--
  RealTimeDemo.html
  GJ_StampTour

  Created by Js Na on 2023/09/13.
  Copyright © 2023 Js Na, All rights reserved.
-->
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공연 정보</title>
    <style>
        @import url('/css/font.css');
        @import url('/css/root.css');

        .titleBar {
            /* invert */
            filter: invert(1) grayscale(1) brightness(2);
        }

        body,
        html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow-y: scroll;
        }

        .MainContainer {
            width: 100%;
            height: 100%;
            margin-top: 3em;
            margin-bottom: 3em;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(180deg, #000000 0%, #000000 30%, #00000033 100%);
        }

        .BackgroundGradient {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -5678;
            background-color: #000000;
            transition: all 1s ease-in-out;
        }

        .PlayerContainer {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            margin: 2em;
            margin-top: 5em;
            color: #ffffff;
        }
    </style>
</head>

<body>
    <div id="titleBar" class="titleBar">
        <img class="titleLogo" src="/images/StampTourLogo.png" alt="스탬프투어">
        <h1>공연 관리자</h1>
    </div>
    <div id="BackgroundGradient" class="BackgroundGradient"></div>
    <div class="MainContainer">
        <div class="PlayerContainer">
            <input type="text" id="PlayerBackground" placeholder="배경 색상">
            <button id="SendButton" onclick="sendText('PlayerBackground');">전송</button>
            <input type="text" id="PlayerTitle" placeholder="제목">
            <button id="SendButton" onclick="sendText('PlayerTitle');">전송</button>
        </div>
        <script src="https://unpkg.com/@supabase/supabase-js"></script>
        <script src="https://unpkg.com/rabbit-lyrics" type="text/javascript"></script>
        <script src="/scripts/root.js"></script>
        <script>
            const { createClient } = supabase;
            const SUPABASE_URL = "https://uysgiuxfgczmyhbfwmzn.supabase.co";
            const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5c2dpdXhmZ2N6bXloYmZ3bXpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTQ2MTk1ODQsImV4cCI6MjAxMDE5NTU4NH0.n8p4SccXUx7BYEB2RXPlNlpsnqYPDzXLDcELAWQyHsM";

            const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);
            console.log(supabaseClient);
            const liveChannel = supabaseClient.channel("JsNa_GJ_LiveShow", {
                config: {
                    broadcast: { ack: true },
                },
            });

            liveChannel.subscribe((status) => {
                // Wait for successful connection
                if (status !== 'SUBSCRIBED') { return }

                console.log('Connected to live updates.')
                // Send a message once the client is subscribed
                liveChannel.send({
                    type: 'broadcast',
                    event: 'SetPlayerBackground',
                    payload: { message: '#603295' },
                });
            });
            eById("PlayerBackground").addEventListener("keyup", function (event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    sendText("PlayerBackground");
                }
            });
            eById("PlayerTitle").addEventListener("keyup", function (event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    sendText("PlayerTitle");
                }
            });
            function sendText(i) {
                let InputText = eById(i);
                console.log(InputText.value);
                liveChannel.send({
                    type: 'broadcast',
                    event: `Set${i}`,
                    payload: { message: InputText.value },
                });
            }
        </script>
</body>

</html>